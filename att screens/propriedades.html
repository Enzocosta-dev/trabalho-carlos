<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rentify - Acomoda√ß√µes</title>
    <link rel="stylesheet" href="css.css">
    <style>
        /* Topo */
        .top-bar {
            display: flex;
            justify-content: flex-end;
            align-items: center;
            padding: 10px 20px;
            background-color: #f5f5f5;
            position: relative;
        }

        .perfil-container {
            position: relative;
            cursor: pointer;
            margin-left: 20px;
        }

        .perfil-container img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
        }

        .perfil-dropdown {
            display: none;
            position: absolute;
            right: 0;
            top: 50px;
            background: white;
            border: 1px solid #ccc;
            border-radius: 8px;
            width: 200px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            z-index: 1000;
        }

        .perfil-dropdown p {
            margin: 10px;
            color: black; /
        }

        .perfil-dropdown button {
            margin: 10px;
            padding: 8px 12px;
            background: red;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            width: calc(100% - 20px);
        }

        /* Modal b√°sico */
        #modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.7);
            justify-content: center;
            align-items: center;
        }

        #modal .modal-content {
            background: #fff;
            padding: 20px;
            width: 90%;
            max-width: 600px;
            border-radius: 10px;
            position: relative;
        }

        .close {
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 24px;
            cursor: pointer;
        }

        .card {
            cursor: pointer;
        }
    </style>
</head>

<body>
    <header class="navbar">
        <div class="logo">
            <img src="imagens/LogoRentify.png" alt="Logo" />
        </div>
        <nav>
            <ul>
                
                <li><a href="propriedades.html">Acomoda√ß√µes</a></li>
                <li><a href="anuncie.html">Anuncie</a></li>
                <!-- Bot√£o do admin -->
                <li id="admin-btn-container"></li>
                <!-- Foto de perfil -->
                <li>
                    <div class="perfil-container" id="perfilContainer">
                        <img id="fotoPerfil" src="imagens/default.png" alt="Foto do Perfil">
                        <div class="perfil-dropdown" id="perfilDropdown">
                            <p id="nomeUsuario">Nome: </p>
                            <p id="emailUsuario">Email: </p>
                            <button id="btnSair">Sair</button>
                        </div>
                    </div>
                </li>
            </ul>
        </nav>
    </header>

    <section class="search-box">
        <select id="filtro-onde">
            <option value="">Onde?</option>
            <option value="rio de janeiro">Rio de Janeiro</option>
            <option value="s√£o paulo">S√£o Paulo</option>
            <option value="minas gerais">Minas Gerais</option>
            <option value="bahia">Bahia</option>
        </select>

        <select id="filtro-quando">
            <option value="">Quando?</option>
            <option value="Mes1a4">Janeiro - Abril</option>
            <option value="Mes5a8">Maio - Agosto</option>
            <option value="Mes9a12">Setembro - Dezembro</option>
        </select>

        <select id="filtro-hospedes">
            <option value="">H√≥spedes?</option>
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5+">5+</option>
        </select>

        <button class="search-btn">üîç</button>
        <button class="reset-btn">‚ü≥ Limpar</button>
    </section>

    <main>
        <h2>Acomoda√ß√µes mais procuradas</h2>
        <div class="cards-container" id="cards-container">
            <!-- Cards ser√£o gerados via JS -->
        </div>
    </main>

    <!-- Modal -->
    <div id="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <img id="modal-img" src="" alt="Acomoda√ß√£o" style="width:100%; border-radius:10px;">
            <h3 id="modal-titulo"></h3>
            <p id="modal-descricao"></p>
            <p><strong>Localiza√ß√£o:</strong> <span id="modal-localizacao"></span></p>
            <p><strong>Pre√ßo:</strong> <span id="modal-preco"></span></p>
            <p><strong>H√≥spedes:</strong> <span id="modal-hospedes"></span></p>
            <p><strong>Dispon√≠vel:</strong> <span id="modal-mes"></span></p>
        </div>
    </div>
    <a href="esteregg.html" class="botao">.</a>
        
</a>

    <footer>
        <p>Grupo - Enzo C. / Gustavo S. / Henrique / Raphael V. / Yuri C.</p>
    </footer>

    <script>
        const container = document.getElementById('cards-container');
        const modal = document.getElementById('modal');
        const closeModal = document.querySelector('.close');
        const modalImg = document.getElementById('modal-img');
        const modalTitulo = document.getElementById('modal-titulo');
        const modalDescricao = document.getElementById('modal-descricao');
        const modalLocalizacao = document.getElementById('modal-localizacao');
        const modalPreco = document.getElementById('modal-preco');
        const modalHospedes = document.getElementById('modal-hospedes');
        const modalMes = document.getElementById('modal-mes');

        // Fun√ß√£o para criar card
        function criarCard(propriedade) {
            const card = document.createElement('div');
            card.className = 'card';
            card.dataset.titulo = propriedade.LOCAL;
            card.dataset.descricao = propriedade.DESCRICAO || "Detalhes da propriedade";
            card.dataset.localizacao = propriedade.LOCAL;
            card.dataset.preco = `R$${parseFloat(propriedade.PRECO).toFixed(2)} por noite`;
            card.dataset.hospedes = propriedade.QUARTOS;
            card.dataset.mes = propriedade.MES || "Dispon√≠vel";
            card.dataset.img = propriedade.IMAGEM;

            card.innerHTML = `
                <img src="${propriedade.IMAGEM}" alt="Acomoda√ß√£o">
                <div class="card-info">
                    <h3>${propriedade.LOCAL}</h3>
                    <p>R$${parseFloat(propriedade.PRECO).toFixed(2)} <br> ${propriedade.LOCAL}</p>
                    <p>Quartos: ${propriedade.QUARTOS}</p>
                </div>
            `;

            card.addEventListener('click', () => {
                modalImg.src = card.dataset.img;
                modalTitulo.textContent = card.dataset.titulo;
                modalDescricao.textContent = card.dataset.descricao;
                modalLocalizacao.textContent = card.dataset.localizacao;
                modalPreco.textContent = card.dataset.preco;
                modalHospedes.textContent = card.dataset.hospedes;
                modalMes.textContent = card.dataset.mes;
                modal.style.display = 'flex';
            });

            container.appendChild(card);
        }

        // Buscar dados da API
        fetch('http://127.0.0.1:5000/propriedades')
            .then(res => res.json())
            .then(data => data.forEach(propriedade => criarCard(propriedade)))
            .catch(err => console.error("Erro ao carregar propriedades:", err));

        // Fechar modal
        closeModal.addEventListener('click', () => modal.style.display = 'none');
        window.addEventListener('click', e => { if (e.target === modal) modal.style.display = 'none'; });

        // Filtros
        const btnBuscar = document.querySelector('.search-btn');
        const btnReset = document.querySelector('.reset-btn');

        btnBuscar.addEventListener('click', () => {
            const onde = document.getElementById('filtro-onde').value.toLowerCase();
            const quando = document.getElementById('filtro-quando').value.toLowerCase();
            const hospedes = document.getElementById('filtro-hospedes').value.toLowerCase();

            document.querySelectorAll('.card').forEach(card => {
                const local = card.dataset.localizacao.toLowerCase();
                const data = card.dataset.mes.toLowerCase();
                const numHospedes = card.dataset.hospedes.toLowerCase();

                if (
                    (onde === "" || local.includes(onde)) &&
                    (quando === "" || data.includes(quando)) &&
                    (hospedes === "" || numHospedes === hospedes || (hospedes === "5+" && parseInt(numHospedes) >= 5))
                ) {
                    card.style.display = "block";
                } else {
                    card.style.display = "none";
                }
            });
        });

        btnReset.addEventListener('click', () => {
            document.getElementById('filtro-onde').value = "";
            document.getElementById('filtro-quando').value = "";
            document.getElementById('filtro-hospedes').value = "";
            document.querySelectorAll('.card').forEach(card => card.style.display = "block");
        });

        // Mostrar bot√£o de admin se o usu√°rio logado for ADM
        function mostrarBotaoAdmin() {
            const usuario = JSON.parse(localStorage.getItem("usuario"));
            const container = document.getElementById("admin-btn-container");

            if (usuario && usuario.NIVEL === "adm") {
                const li = document.createElement("li");
                const link = document.createElement("a");
                link.href = "painel_adm.html"; // p√°gina do painel de admin
                link.textContent = "Painel ADM";
                li.appendChild(link);
                container.appendChild(li);
            }
        }

        // Mostrar foto de perfil e dropdown
        function configurarPerfil() {
            const usuario = JSON.parse(localStorage.getItem("usuario"));
            if (usuario) {
                document.getElementById("fotoPerfil").src = usuario.FOTO || "imagens/default.png";
                document.getElementById("nomeUsuario").textContent = "Nome: " + usuario.NOME;
                document.getElementById("emailUsuario").textContent = "Email: " + usuario.EMAIL;
            }

            const perfilContainer = document.getElementById("perfilContainer");
            const perfilDropdown = document.getElementById("perfilDropdown");
            perfilContainer.addEventListener("click", () => {
                perfilDropdown.style.display = perfilDropdown.style.display === "block" ? "none" : "block";
            });

            window.addEventListener("click", (e) => {
                if (!perfilContainer.contains(e.target)) {
                    perfilDropdown.style.display = "none";
                }
            });

            document.getElementById("btnSair").addEventListener("click", () => {
                localStorage.removeItem("usuario");
                window.location.href = "login.html";
            });
        }

        window.addEventListener("DOMContentLoaded", () => {
            mostrarBotaoAdmin();
            configurarPerfil();
        });
    </script>
</body>
</html>
